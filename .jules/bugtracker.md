# Bug Tracker

| ID | Issue | Severity | User Opinion | Status |
|----|-------|----------|--------------|--------|
| BUG-001 | **Memory Leak in ServerStart**: `RtdServerBase::ServerStart` overwrites `m_callback` without calling `Release()` on the existing pointer. This causes a reference leak if the method is called multiple times. | Medium | Fix Approved | Fixed |
| SEC-001 | **Potential Registry Wipe**: `DeleteKeyUser` (registry.h) does not validate if `szKey` is empty. If called with an empty string (e.g., empty ProgID), it targets `Software\Classes`, recursively deleting all user COM registrations. | Critical | Fix Approved | Fixed |
| SEC-002 | **Buffer Safety**: `RegisterServer` uses a fixed `MAX_PATH` buffer for `GetModuleFileNameW`. May fail on systems with long paths enabled if the library is deeply nested. Also lacks return value checking. | Low | Fix Approved | Fixed |
| BUG-002 | **Missing Null Check**: `ServerStart` and `Heartbeat` do not check if the output parameter `pfRes` is null before writing to it, potentially causing a crash (E_POINTER). | Low | Fix Approved | Fixed |
| BUG-003 | **Interface Signature Mismatch**: `IRTDUpdateEvent::get_HeartbeatInterval` in `defs.h` returns `long` directly, whereas the standard COM binary interface requires returning `HRESULT` and passing the value via an out pointer (`long*`). This causes a binary incompatibility with Excel, likely leading to crashes or stack corruption. | Critical | Fix Approved | Fixed |
| SEC-003 | **Excessive Registry Privileges**: `SetKeyAndValueUser` in `registry.h` requests `KEY_ALL_ACCESS` permission. While in HKCU this is usually allowed, best practice (Least Privilege) suggests requesting only `KEY_SET_VALUE` or `KEY_WRITE` to minimize potential damage or permission errors. | Low | Fix Approved | Fixed |
| BUG-004 | **Potential Crash in SetKeyAndValueUser**: The function constructs a `std::wstring` from `szKey` without checking if it is `nullptr`. While intended for internal use, passing a null key (e.g., via `RegisterServer` with invalid macros) will cause a crash (std::logic_error or Access Violation). | Low | Fix Approved | Fixed |
| BUG-005 | **SafeArray Dimension Swap**: `CreateRefreshDataArray` sets `bounds[0]` to size 2 and `bounds[1]` to `TopicCount`. In `SafeArrayCreate`, `rgsabound[0]` typically defines the *right-most* dimension (Columns), not the left-most. This likely creates an array of `[TopicCount][2]` instead of the `[2][TopicCount]` expected by Excel. | High | Fix Approved | Fixed |
| BUG-006 | **Unhandled C++ Exceptions**: COM entry points (`DllGetClassObject`, `DllRegisterServer`) and internal helpers (`registry.h`) use standard C++ features that can throw exceptions (`new`, `std::wstring`, `std::vector`). These exceptions are not caught, which violates COM rules and crashes the host application (Excel). | Critical | Fix Approved | Fixed |
| BUG-007 | **Unsafe Memory Allocation**: `ClassFactory::CreateInstance` and `DllGetClassObject` use throwing `new` operator. If memory allocation fails, `std::bad_alloc` is thrown instead of returning `E_OUTOFMEMORY`. | Medium | Fix Approved | Fixed |
